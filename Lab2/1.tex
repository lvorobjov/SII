\chapter{Ход работы}

\section{Задание на лабораторную работу}

Получить дополнительные знания для проектируемой
экспертной системы из таблицы, содержащей сведения о
зависимости некоторого целевого параметра от характеристик
заданной предметной области. Источником знаний считать
реляционную базу данных (таблицу), в которой собраны данные о
связях между различными параметрами (значения параметров задать
самостоятельно, исходя из реальных ситуаций). Сведения в таблице
должны характеризовать некоторую подцель, т.е. поддерево,
соответствующее одному из вопросов главного дерева решений
задачи. Пути достижения выбранной подцели должны быть
выявлены и представлены новым поддеревом решений и
продукционными правилами, полученными методом индуцирования
знаний из таблицы.

В главном дереве решений может появится необходимость определения дорожного знака. %Построим поддерево для получения ответа на вопрос «Определите значение дорожного знака».

Поддеревом определения значения дорожного знака является определение вида знака: предупреждающий, знак приоритета, запрещающий, предписывающий, информационно-указательный и знак сервиса. А также уточняющие таблички к дорожным знакам.

\section{Исходная таблица данных}

Выборку из 40 дорожных знаков поместили в таблицу \ref{tab:signs}. Критерии: $C_1$ --- Цвет фона; $C_2$ --- Наличие окантовки; $C_3$ --- Наличие знака в знаке; $C_4$ --- Форма внутреннего знака; $C_5$ --- Наличие стрелок; $C_6$ --- Наличие красной стрелки; $C_7$ --- Характер текста; $C_8$ --- Вид транспорта; $C_9$ --- Тип зданий.

\begin{landscape}
\input{table.tex}
\end{landscape}

\section{Алгоритм индуцирования знаний}

Шаги алгоритма С4.5.

\textbf{Шаг 1}. Для всех условных атрибутов $X_1,\,X_2,\,\ldots,\,X_m$ таблицы $T$ вычисляем критерий разбиения $Gain(X_i)$. Выбираем такой атрибут $X$, для которого $Gain(X_i)$ максимально.

Критерий разбиения вычисляется по формуле
$$
Gain(X) = Info(T) - Info_X(T),
$$
где $Info(T)$ --- энтропия таблицы $T$, которая вычисляется по формуле
$$
Info(T) = -\sum_{i=0}^{k} p(C_i) \cdot \log_2(p(C_i));
$$
где $p(C_i)$ --- вероятность выбора строки со значением атрибута класса $C_i$ и вычисляется по формуле
$$
p(C_i) = \frac{freq(C_i,\,T)}{|T|},
$$
где $freq(C_i,T)$ --- количество примеров из множества $T$, в которых атрибут класса равен $C_i$;
а $Info_X(T)$ --- энтропия таблицы $T$ после ее разбиения по атрибуту $X$ на $n$ подтаблиц. Вычисляется по формуле
$$
Info_X(T) = \sum_{i=0}^{n} \frac{|T_i|}{|T|} \cdot Info(T_i).
$$

\textbf{Шаг 2}. Разбиваем таблицу по выбранному атрибуту на $N$ подтаблиц. Проверяем каждую подтаблицу.

\textbf{2.1} Если подтаблица монотонна (все строки к одному классу), то порождаем правило.

\textbf{2.2} В противном случае рекурсивно применяем алгоритм C4.5 к полученной подтаблице.

\begin{figure}[H]
	\centering
	\begin{algorithm}[H]
		\SetAlgoLined
		\DontPrintSemicolon
		\KwIn{$T,\,i_0,\,n,\,m,\,N$}
		определить критерий разбиения $X$\;
		сортировать таблицу $T$ по критерию $X$\;
		\ForEach{подтаблица $T_i$}{
			\eIf{подтаблица $T_i$ монотонна}{
				вставить конечный узел $N_i$ в дерево решений $N$\;
			} {
				вставить узел $N_i$ в дерево решений $N$\;
				рекурсивный вызов данной проуедуры для подтаблицы $T_i$ и узла $N_i$\;
			}
		}
	\end{algorithm}
	\caption{Рекурсивный алгоритм построения дерева решений}\label{fig:alg-c4.5}
\end{figure}

\begin{figure}[H]
	\centering
	\begin{algorithm}[H]
		\SetAlgoLined
		\DontPrintSemicolon
		\KwIn{$T,\,i_0,\,n,\,m$}
		\KwOut{$X$}
		$H := $ вычислить энтропию таблицы $T$\;
		$H_{min} := H$\;
		$X := $ не определено\;
		\For{$i$ от 0 до $m-1$}{
			$H_i := $ вычислить энтропию таблицы $T$ при разбиении ее по атрибуту $X_i$\;
			\If{$H_i < H_{min}$}{
				$H_{min} := H_i$\;
				$X := X_i$\;
			}
		}
	\end{algorithm}
	\caption{Алгоритм выбора критерия разбиения таблицы}\label{fig:alg-crit}
\end{figure}

\begin{figure}[H]
	\centering
	\begin{algorithm}[H]
		\SetAlgoLined
		\DontPrintSemicolon
		\KwIn{$T,\,i_0,\,n,\,k,\,X,\,l$}
		\KwOut{$H$}
		инициализировать двумерный массив счетчиков размером $k,l$\;
		инициализировать счетчики размеров подтаблиц $S$ размером $l$\;
		\For{$i$ от $i_0$ до $i_0+n-i$}{
			увеличить счетчик размера подтаблицы, соответствующий значению атрибута $X$\;
			увеличить счетчик, соответствующий значению атрибутов $C$ и $X$\;
		}
		$H := 0$\;
		\For{$i$ от 0 до $l-1$}{
			\For{$j$ от 0 до $k-1$}{
				\If{$C_{i,j} > 0$}{
					$p = \frac{C_{i,j}}{n}$\;
					$H_i -= p \cdot \log_2 (p)$\;
				}
			}
			$H += \frac{S_i}{n} \cdot H_i$\;
		}
	\end{algorithm}
	\caption{Алгоритм вычисления энтропии таблицы}\label{fig:alg-entro2}
\end{figure}

\begin{multicols}{2}
Пример таблицы:
$$
T = \left( \begin{array}{cc|c|cc}
G & C_0 & C_1 & C_2 & C_3 \\
1 & 0 & 1 & 0 & 1 \\
2 & 1 & 1 & 0 & 1 \\
3 & 1 & 0 & 1 & 0 \\
4 & 0 & 0 & 0 & 1 \\
5 & 0 & 1 & 1 & 0 \\
\end{array} \right)
$$

\begin{figure}[H]
	\centering
	\begin{tikzpicture}
	\Tree [.Root n1 n2 n3 [.ND n4 n5 [.G k1 k2 ] ] n6 ]
	\end{tikzpicture}
	\caption{Дерево решений}
\end{figure}
\end{multicols}

Продукционное правило:
\begin{tabbing}
	\hspace{4em}\=\kill
	\bf ЕСЛИ \> таблица имеет простую структуру \\ 
	\bf И \> известна ширина каждой колонки \\
	\bf ТО \> \tabfill{для её создания
		можно использовать окружение tabbing}
\end{tabbing} 

\begin{figure}[H]
	\centering
	\begin{algorithm}[H]
		\SetAlgoLined
		\DontPrintSemicolon
		\KwIn{$T,\,i_0,\,n,\,k$}
		\KwOut{$H$}
		инициализировать массив счетчиков $C$ размером $k$\;
		\For{$i$ от $i_0$ до $i_0+n-i$}{
			увеличить счетчик $C$, соответствующий значению атрибута класса\;
		}
		$H := 0$\;
		\For{$i$ от 0 до $k-1$}{
			\If{$C_i > 0$}{
				$p = \frac{C_i}{n}$\;
				$H -= p \cdot \log_2 (p)$\;
			}
		}
	\end{algorithm}
	\caption{Алгоритм вычисления энтропии таблицы}\label{fig:alg-entro}
\end{figure}
